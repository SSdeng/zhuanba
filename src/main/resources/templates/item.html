<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>商品详情页</title>
    <link href="../static/css/item.css" rel="stylesheet">
</head>

<body>
<div class="dingbu">
    <div class="denglu-font">
        <a href="#" id="dingbuhome"><img src="../images/logo.jpg"></a>

        <div class="denglu-font2">
            <a href="login.html" class="dengLu">登录</a>
            <a href="register.html" class="zhuche">注册</a>
            <a href="#" class="xiaoxi">销售通知</a>
        </div>
    </div>
</div>
<div class="list-1">
    <ul class="list-ul-2" style="position: relative;right: 190px;">
        <div class="img"><img src="../images/logo1.jpg" width="55px" height="55px" class="img-logo"/></div>
        <li><a href="login.html">全部商品分类</a></li>
        <li><a href="#" class="click1">小米手机</a></li>
        <li><a href="#">红米</a></li>
        <li><a href="tv4c.html">电视</a></li>
        <li><a href="bijibenmenu.html">笔记本</a></li>
        <li><a href="#">空调</a></li>
        <li><a href="#">新品</a></li>
        <li><a href="#">路由器</a></li>
        <li><a href="#">智能硬件</a></li>
        <li><a href="#">服务</a></li>
        <li><a href="#">社区</a></li>
    </ul>
</div>
<div id="itemboard" class="board">
    <div class="imge">
        <img src="../images/img49.png" class="itemimage">
    </div>

    <div id="details" class="details">
        <h1 id="itemname" class="itemname" th:text="${item.itemName}"></h1>
        <h3 class="sellInfo" th:text="剩余${item.count}件商品">暂无销售信息</h3>
        <h3 class="sellerName" th:text="${item.user.username}"></h3>
        <h1 class="price" th:text="${item.price}元">￥9999</h1>
        <h1 class="level" th:text="${item.level}成新">全新！</h1>
        <input type="button" class="buybutton" value="加入购物车">
    </div>

</div>
<div class="container">
    <h2 class="label">商品描述</h2>
    <span class="itemdescription" th:text="${item.description}">暂无商品的描述信息</span>
</div>

<div class="container">
    <div>
        <h2 class="label">评论</h2>
    </div>
    <div class="comment-send">

        <div id="commentForm" method="GET">
                <textarea class="comment-send-input" name="comment" form="commentForm" cols="80" rows="5"
                          id="commentboard"
                          placeholder="请自觉遵守互联网相关的政策法规，严禁发布色情、暴力、反动的言论。"></textarea>
            <input class="comment-send-button" type="submit" value="发表评论">
        </div>
    </div>

    <div class="comment-list" id="commentList">

        <div th:each="comment:${comments}" class="comment comment-bottom">
            <div class="comment-content">

                <p class="comment-content-name" th:text="${comment.user.username}">Leon</p>

                <p class="comment-content-article" th:text="${comment.content}">Hello World!</p>

                <p class="comment-content-footer">
                        <span class="comment-content-footer-timestamp" th:text="${comment.createTime}">2020-08-08
                            10:08</span>
                </p>
            </div>

            <div class="cls"></div>
        </div>
    </div>
</div>

<script src="../static/jquery/jquery2.1.4.js"></script>
<script src="../static/layer/layer.js"></script>
<script th:inline="javascript">
    var itemId = 0;
    // var itemId = [[${item.id}]];

    var userId = localStorage.getItem('userId');
    console.log(userId);


    $(function () {
        $(".buybutton").on('click', function () {
            if (userId == null || userId == "") {
                layer.msg("请先登录再添加购物车");
                return;
            } else if (itemId == null || itemId == "") {
                layer.msg("暂无此商品信息，无法添加购物车");
                return;
            }
            $.ajax({
                type: "POST",
                dataType: "json",
                url: "/api/comment/item?itemId=" + itemId,
                data: {"itemId": itemId},
                success: function (data) {
                    if (data.code == 0) {
                        layer.msg("添加购物车成功");
                    } else {
                        layer.msg("添加购物车失败");
                    }
                },
                error: function (data) {

                }
            })
        });

        $(".comment-send-button").on('click', function () {
            var content = $("#commentboard").val();
            if (userId == null || userId == "") {
                layer.msg("请先登录再进行评论");
                return;
            } else if (itemId == null || itemId == "") {
                layer.msg("暂无此商品信息，无法添加评论");
                return;
            }
            $.ajax({
                type: "POST",
                dataType: "json",
                url: "/api/cart/add?itemId=" + itemId,
                data: {"userId": itemId, "content": content},
                success: function (data) {
                    if (data.code == 0) {
                        layer.msg("添加购物车成功");
                    } else {
                        layer.msg("添加购物车失败");
                    }
                },
                error: function (data) {

                }
            })
        });
    })
</script>
</body>
